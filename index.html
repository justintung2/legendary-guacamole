<!DOCTYPE html>
<html>
<head>
 	<meta charset="utf-8" />
 	<meta name="viewport" content="width=device-width, initial-scale=1.0">
 	<script src='https://api.mapbox.com/mapbox-gl-js/v0.44.2/mapbox-gl.js'></script>
 	<link rel="stylesheet" href="https://rawgit.com/tpreusse/radar-chart-d3/master/src/radar-chart.css">
 	<link href='https://api.mapbox.com/mapbox-gl-js/v0.44.2/mapbox-gl.css' rel='stylesheet' />
 	<script src="http://d3js.org/d3.v3.js"></script>
	<script src="https://rawgit.com/tpreusse/radar-chart-d3/master/src/radar-chart.js"></script>
 	<link href='style.css' rel='stylesheet' />
 	<link href="https://fonts.googleapis.com/css?family=Josefin+Sans" rel="stylesheet">
    <link href='https://api.tiles.mapbox.com/mapbox.js/v1.0.0/mapbox.css' rel='stylesheet' />
<script src='https://api.tiles.mapbox.com/mapbox.js/v1.0.0/mapbox.js'></script>
<!-- <script src='zip_code_040114.json'></script> -->
<script src='cheerup.json'></script>
</head>
<style>
 html,
 body,
 #map {
     padding: 0;
     margin: 0;
     width: 100%;
     height: 100%;
 }
 .leaflet-top-pane {
     pointer-events: none;
 }
 </style>
<body>

	<div id="navbar">
		<a href="#">Noise</a>
			<form class="noisebuttons">
				<input type="radio" name="noise" value="low"> Low
				<input type="radio" name="noise" value="medium">Medium
				<input type="radio" name="noise" value="high">High
			</form>
		<a href="#">Parks</a>
			<form class="parksbuttons">
				<input type="radio" name="noise" value="low"> Low
				<input type="radio" name="noise" value="medium">Medium
				<input type="radio" name="noise" value="high">High
			</form>
		<a href="#">Transportation</a>
			<form class="transportbuttons">
				<input type="radio" name="noise" value="low"> Low
				<input type="radio" name="noise" value="medium">Medium
				<input type="radio" name="noise" value="high">High
			</form>
		<a href="#">Income</a>
			<form class="incomebuttons">
				<input type="radio" name="noise" value="low"> Low
				<input type="radio" name="noise" value="medium">Medium
				<input type="radio" name="noise" value="high">High
			</form>
		<form class="submitbutton">
			<input type="submit" value="Update Filter">
		</form>
	</div>


	<div id='map'></div>

	<div class="charts"></div>

	<div class="textportion">

		<p>New York City's 304 square miles provide living space for more than 10 million inhabitants. However, not all living spaces are created equal. Some locations are considered more liveable than others. We compiled data on living conditions that matter to most people when deciding on where to live, including access to public transport, noise levels, and the average income in the area which often dictates how high the cost of living is.
		</p>

	</div>

	<script>

	//reading data
	d3.csv("data.csv", function(err, data){

		var income = 3;
		var parks = 2;
		var noise = 2;
		

		console.log(data);

		console.log(filter(income, parks, noise, data));
		
	});

	function getNewIncome(data, num1, num2) {
		// body...
		var newdata = [];
		for (var i = 0; i < data.length; i++) {
			if (data[i].Income> num1 && data[i].Income<= num2) {
				newdata.push(data[i]);
			}
		}

		// if(newdata.length == 0){
		// 	newdata = data;
		// }

		return newdata
	}

	function getNoiseParks(data, num1, num2){
		var newdata = [];

		for (var i = 0; i < data.length; i++) {
			if (data[i].Park> num1 && data[i].Park <= num2) {
				newdata.push(data[i]);
			}
			
		}

		// if(newdata.length == 0){
		// 	newdata = data;
		// }

		return newdata;
	}

	function getNewNoise(data, num1, num2){
		var newdata = [];

		for (var i = 0; i < data.length; i++) {
			if (data[i].NoiseComplaints > num1 && data[i].NoiseComplaints <= num2) {
				console.log("b")
				newdata.push(data[i]);
			} else {
				console.log("no");
			}
			
		}
		
		console.log(newdata.length);
		// if(newdata.length == 0){
		// 	newdata = data;
		// }

		return newdata;
	}

	function zipcodes(dataArr) {
		// body...
		zips = []
		for (var i = 0; i < dataArr.length; i++) {
			zips.push(dataArr[i].Zip);
		}

		return zips;
	}

	function noiseLevel(noise, parkArr){

		if (noise == 1) {

			var noiseArr = getNewNoise(parkArr, 0, 1400);
			return zipcodes(noiseArr);

		} else if (noise == 2) {
			
			
			var noiseArr = getNewNoise(parkArr, 14000, 2800);
			
			console.log(parkArr);
			console.log(noiseArr);
			
			return zipcodes(noiseArr);
		} else {

			var noiseArr = getNewNoise(parkArr, 2800, 4500);
			return zipcodes(noiseArr);
			}
	}


	function parkLevel(parks, noise, incomeArr){

		if (parks ==1) {

			var parkArr = getNoiseParks(incomeArr, 0, 19);

			if(parkArr.length> 3){

				return noiseLevel(noise, parkArr);

			} else {
				return zipcodes(parkArr);
			}

		} else if (parks = 2) {

			var parkArr = getNoiseParks(incomeArr, 19, 38);

			console.log(parkArr);
			

			if(parkArr.length> 3){

				console.log(parkArr);

				return noiseLevel(noise, parkArr);

			} else {
				return zipcodes(parkArr);
			}

		}else{

			var parkArr = getNoiseParks(incomeArr, 38, 60)

			if(parkArr.length> 3){

				return noiseLevel(noise, parkArr);

			} else {
				return zipcodes(parkArr);
			}

		}

	}


	//filter input:data output: zipcode
	function filter(income, parks, noise, data) {
		// income: will be a number 1, 2, 3, 4, 5
		//parks: 1, 2, 3
		//noise: 1, 2, 3
		zips = [];
		if (income == 1) {

			var  incomeArr = getNewIncome(data, 0, 78000);

			if (incomeArr.length>3) {

				return parkLevel(parks, noise, incomeArr);

			} else{
				return zipcodes(incomeArr);
			}

		} else if (income == 2){

			var  incomeArr = getNewIncome(data, 78000, 168000);

			if (incomeArr.length>3) {

				return parkLevel(parks, noise, incomeArr);
				
			} else{
				return zipcodes(incomeArr);
			}

		} else if (income == 3) {

			var  incomeArr = getNewIncome(data, 168000, 258000);

			if (incomeArr.length>3) {

				return parkLevel(parks, noise, incomeArr);
				
			} else{
				return zipcodes(incomeArr);
			}

		} else if (income == 4){

			var  incomeArr = getNewIncome(data, 258000, 348000);

			if (incomeArr.length>3) {

				return parkLevel(parks, noise, incomeArr);
				
			} else{
				return zipcodes(incomeArr);
			}

		}else{

			var  incomeArr = getNewIncome(data, 348000, 400000);

			if (incomeArr.length>3) {

				return parkLevel(parks, noise, incomeArr);
				
			} else{
				return zipcodes(incomeArr);
			}

		}
	}


	// When the user scrolls the page, execute myFunction
	window.onscroll = function() {myFunction()};

	// Get the navbar
	var navbar = document.getElementById("navbar");

	// Get the offset position of the navbar
	var sticky = navbar.offsetTop;

	// Add the sticky class to the navbar when you reach its scroll position. Remove "sticky" when you leave the scroll position
	function myFunction() {
	  if (window.pageYOffset >= sticky) {
	    navbar.classList.add("sticky")
	  } else {
	    navbar.classList.remove("sticky");
	  }
	}


	RadarChart.defaultConfig.color = function() {};
	RadarChart.defaultConfig.radius = 3;
	RadarChart.defaultConfig.w = 400;
	RadarChart.defaultConfig.h = 400;
	</script>

	<span></span>

	<script>
	var data = [
	  {
	    className: 'characteristics', // optional can be used for styling
	    axes: [
	      {axis: "Parks", value: 10},
	      {axis: "Transportation", value: 6},
	      {axis: "Noise", value: 5},
	      {axis: "Income", value: 9}
	    ]
	  },

	];
	function randomDataset() {
	  return data.map(function(d) {
	    return {
	      className: d.className,
	      axes: d.axes.map(function(axis) {
	        return {axis: axis.axis, value: (0.4 * 10)};
	      })
	    };
	  });
	}

	var chart = RadarChart.chart();
	var cfg = chart.config(); // retrieve default config
	var svg = d3.select('body').append('svg')
	  .attr('width', cfg.w + cfg.w + 50)
	  .attr('height', cfg.h + cfg.h / 4);
	svg.append('g').classed('single', 1).datum(randomDataset()).call(chart);


	</script>


<!-- <script>
	mapboxgl.accessToken = "pk.eyJ1IjoianQ2ODlzcDE4IiwiYSI6ImNqZXJtdTV2aTE2NW8yd2x0YTRyZnBnMHMifQ.yhMtx5-uADU9vqGlVgQT4g"
	var map = new mapboxgl.Map({
		container:"map",
		style: "mapbox://styles/jt689sp18/cjgnw8klb00062rp9hh2fgi94",
		center: [-73.9851,40.7589],
		zoom:9
	})

	map.scrollZoom.disable()
	map.addControl(new mapboxgl.NavigationControl());
	map.getCanvas().style.cursor = 'default';
	map.dragRotate.disable();
	map.touchZoomRotate.disableRotation();

</script> -->
<script type="text/javascript">
 var map = L.mapbox.map('map').setView([40.75, -73.94], 15);

// Set base style of vector data
 function style(feature) {
     return {
     weight: 0,
     fillOpacity: 0.5,
     fillColor: '#FFEDA0'
     };
 }

// Set hover colors
 function highlightFeature(e) {
     console.log(e);
 var layer = e.target;
     layer.setStyle({
         weight: 10,
         opacity: 1,
         color: '#09F',
         dashArray: '3',
         fillOpacity: 0.7,
         fillColor: '#FEB24C'
     });
 }

// A function to reset the colors when a neighborhood is not longer 'hovered'
 function resetHighlight(e) {
 geojson.resetStyle(e.target);
 }

// Tell MapBox.js what functions to call when mousing over and out of a neighborhood
 function onEachFeature(feature, layer) {
 layer.on({
 mouseover: highlightFeature,
 mouseout: resetHighlight
 });
 }

// Add vector data to map
 geojson = L.geoJson(neighborhoods, {
     style: style,
     onEachFeature: onEachFeature
 }).addTo(map);

 // console.log(geojson);
// Here is where the magic happens: Manipulate the z-index of tile layers,
 // this makes sure our vector data shows up above the background map and
 // under roads and labels.
 var topPane = map._createPane('leaflet-top-pane', map.getPanes().mapPane);
 var topLayer = L.mapbox.tileLayer('bobbysud.map-3inxc2p4').addTo(map);
 topPane.appendChild(topLayer.getContainer());
 topLayer.setZIndex(100);


//pinning action
 // function clickActions(d) {
 //      d3.select("#pinDiv")
 //        .html(d3.select("#pinDiv").html() + makePinnedInfo(d));
 //      d3.select("#pinnedCount")
 //        .html("(" + (document.getElementById("pinDiv").children.length - 1) + ")");
 //    }


//making the pin
 // function makePinnedInfo(d) {
 //      return `
 //      <div class = "pinnedInfo">
 //        <button onclick="deleteDiv(this)"> x </button>
 //        ${makeInfo(d)}
 //      </div>
 //      `
 //    }
 //  }


//deleting pin
 //  function deleteDiv(button) {
 //    d3.select(button.parentNode).remove();
 //    d3.select("#pinnedCount")
 //      .html("(" + (document.getElementById("pinDiv").children.length - 1) + ")");
 //  }

</script>


</body>
</html>
